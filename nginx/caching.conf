# Cache configuration for static assets
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header X-Cache-Status "STATIC";
    
    # Enable gzip for static assets
    gzip_static on;
    
    # Security headers for static assets
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    
    # CORS headers for fonts and assets
    if ($request_method = 'OPTIONS') {
        add_header Access-Control-Allow-Origin '*';
        add_header Access-Control-Allow-Methods 'GET, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        add_header Access-Control-Max-Age 1728000;
        add_header Content-Type 'text/plain; charset=utf-8';
        add_header Content-Length 0;
        return 204;
    }
    
    if ($request_method = 'GET') {
        add_header Access-Control-Allow-Origin '*';
        add_header Access-Control-Allow-Methods 'GET, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        add_header Access-Control-Expose-Headers 'Content-Length,Content-Range';
    }
}

# Cache configuration for HTML files
location ~* \.(html|htm)$ {
    expires 1h;
    add_header Cache-Control "public, must-revalidate";
    add_header X-Cache-Status "HTML";
}

# Cache configuration for API responses
location /api/ {
    # Short cache for API responses
    expires 5m;
    add_header Cache-Control "public, max-age=300";
    add_header X-Cache-Status "API";
    
    # Vary header for different response formats
    add_header Vary "Accept, Accept-Encoding";
}

# Cache configuration for RSS and sitemap
location ~* \.(xml|rss|atom)$ {
    expires 1h;
    add_header Cache-Control "public, max-age=3600";
    add_header X-Cache-Status "XML";
}

# No cache for service worker
location /sw.js {
    expires off;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header X-Cache-Status "NO-CACHE";
}